<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>con-gen-csu - 3&nbsp; A Brief awk Intro</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../nmfs-bioinf/scripts-and-functions.html" rel="next">
<link href="../nmfs-bioinf/shell-prog.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../nmfs-bioinf/awk-intro.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Brief <code>awk</code> Intro</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../nmfs-bioinf/quarto-static/fisheries_header_logo_jul2019.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">con-gen-csu</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nmfs-bioinf/quick-unix-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Quick Unix Review</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nmfs-bioinf/shell-prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Shell Programming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nmfs-bioinf/awk-intro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Brief <code>awk</code> Intro</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nmfs-bioinf/scripts-and-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bash scripts and functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nmfs-bioinf/slurm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Sedna and SLURM intro</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nmfs-bioinf/sbatch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Submitting jobs with <code>sbatch</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nmfs-bioinf/slurm-arrays.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Slurm Job Arrays</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nmfs-bioinf/sequence-alignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Sequence alignment and handling BAM files</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nmfs-bioinf/bioinf-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Bioinformatic file formats</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nmfs-bioinf/snake.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Snakemake Narrative and Topics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nmfs-bioinf/snakemake-relevant-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Snakemake-relevant Python for R Users</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#awks-philosophy-and-basic-syntax" id="toc-awks-philosophy-and-basic-syntax" class="nav-link active" data-scroll-target="#awks-philosophy-and-basic-syntax"><span class="header-section-number">3.1</span> <code>awk</code>’s philosophy and basic syntax</a>
  <ul class="collapse">
  <li><a href="#naming-fields" id="toc-naming-fields" class="nav-link" data-scroll-target="#naming-fields"><span class="header-section-number">3.1.1</span> Naming fields</a></li>
  <li><a href="#so-what" id="toc-so-what" class="nav-link" data-scroll-target="#so-what"><span class="header-section-number">3.1.2</span> So what?</a></li>
  <li><a href="#awk-syntax-on-the-command-line" id="toc-awk-syntax-on-the-command-line" class="nav-link" data-scroll-target="#awk-syntax-on-the-command-line"><span class="header-section-number">3.1.3</span> <code>awk</code> syntax on the command line</a></li>
  </ul></li>
  <li><a href="#enough-talking-lets-start-doing" id="toc-enough-talking-lets-start-doing" class="nav-link" data-scroll-target="#enough-talking-lets-start-doing"><span class="header-section-number">3.2</span> Enough talking, let’s start doing</a>
  <ul class="collapse">
  <li><a href="#print-all-the-lines-in-which-the-first-field-is-sn" id="toc-print-all-the-lines-in-which-the-first-field-is-sn" class="nav-link" data-scroll-target="#print-all-the-lines-in-which-the-first-field-is-sn"><span class="header-section-number">3.2.1</span> Print all the lines in which the first field is <code>SN</code></a></li>
  <li><a href="#printing-the-lines-we-are-interested-in" id="toc-printing-the-lines-we-are-interested-in" class="nav-link" data-scroll-target="#printing-the-lines-we-are-interested-in"><span class="header-section-number">3.2.2</span> Printing the lines we are interested in</a></li>
  <li><a href="#printing-just-the-values-we-are-interested-in" id="toc-printing-just-the-values-we-are-interested-in" class="nav-link" data-scroll-target="#printing-just-the-values-we-are-interested-in"><span class="header-section-number">3.2.3</span> Printing just the values we are interested in</a></li>
  <li><a href="#use-variables-inside-awk" id="toc-use-variables-inside-awk" class="nav-link" data-scroll-target="#use-variables-inside-awk"><span class="header-section-number">3.2.4</span> Use variables inside <code>awk</code></a></li>
  <li><a href="#thats-great.-can-we-add-the-sample-name-in-there" id="toc-thats-great.-can-we-add-the-sample-name-in-there" class="nav-link" data-scroll-target="#thats-great.-can-we-add-the-sample-name-in-there"><span class="header-section-number">3.2.5</span> That’s great. Can we add the sample name in there?</a></li>
  <li><a href="#omg-do-you-seen-where-we-are-going-with-this" id="toc-omg-do-you-seen-where-we-are-going-with-this" class="nav-link" data-scroll-target="#omg-do-you-seen-where-we-are-going-with-this"><span class="header-section-number">3.2.6</span> OMG! Do you seen where we are going with this?</a></li>
  </ul></li>
  <li><a href="#another-example-the-distribution-of-mapping-qualities" id="toc-another-example-the-distribution-of-mapping-qualities" class="nav-link" data-scroll-target="#another-example-the-distribution-of-mapping-qualities"><span class="header-section-number">3.3</span> Another example: the distribution of mapping qualities</a>
  <ul class="collapse">
  <li><a href="#lets-look-at-an-example-bam-file" id="toc-lets-look-at-an-example-bam-file" class="nav-link" data-scroll-target="#lets-look-at-an-example-bam-file"><span class="header-section-number">3.3.1</span> Let’s look at an example bam file</a></li>
  </ul></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up"><span class="header-section-number">3.4</span> Wrap-Up</a></li>
  <li><a href="#looking-toward-tomorrow" id="toc-looking-toward-tomorrow" class="nav-link" data-scroll-target="#looking-toward-tomorrow"><span class="header-section-number">3.5</span> Looking toward tomorrow</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="awk-intro" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Brief <code>awk</code> Intro</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<ul>
<li><code>awk</code> is a lighweight, completely awesome, little scripting language that is perfect for ripping through large text files with a minimal memory footprint.</li>
<li>We will only scratch the surface of it, here, but I hope it encourages <code>awk</code> newcomers to explore it more.</li>
<li><code>awk</code> can make many tasks on the command line simple, fast, and fun.</li>
<li>For a more detailed introduction, you might find <a href="https://eriqande.github.io/eca-bioinf-handbook/sed-awk-and-regular-expressions.html">this chapter</a> of my Bioinformatics Handbook of some use. (And there are many other resources online, as well).</li>
</ul>
<section id="awks-philosophy-and-basic-syntax" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="awks-philosophy-and-basic-syntax"><span class="header-section-number">3.1</span> <code>awk</code>’s philosophy and basic syntax</h2>
<p><code>awk</code> is a utility that:</p>
<ul>
<li>Takes text input from a file or from <code>stdin</code></li>
<li>It automatically goes line-by-line. Treating each line of text as a separate unit.</li>
<li>When it is focused on a line of text, it breaks it into <em>fields</em> which you can think of as columns.</li>
<li>By default, fields, are broken up on whitespace (spaces and TABs), with multiple spaces or TABs being treated as a single delimiter.</li>
<li>You can specify the delimiter.</li>
</ul>
<p>Let’s look through a file together. I will do:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>You can do this if you want</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="You can do this if you want"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gzip</span> <span class="at">-cd</span> data/samtools_stats/s001_stats.tsv.gz <span class="kw">|</span> <span class="fu">less</span> <span class="at">-S</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and we will discuss how <code>awk</code> sees such a file.</p>
<section id="naming-fields" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="naming-fields"><span class="header-section-number">3.1.1</span> Naming fields</h3>
<p>Once <code>awk</code> has read a line of text into memory, and split it into fields, you can access the value of those fields with special names:</p>
<ul>
<li><code>$1</code> refers to the first field (column)</li>
<li><code>$2</code> refers to the second column.</li>
</ul>
<p>If you are beyond the ninth column, the number has to be wrapped in parentheses:</p>
<ul>
<li><code>$(13)</code> refers to the thirteenth column</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>These variables within an <code>awk</code> script are not related to substituted variables in bash. They just happen to share a preceding <code>$</code>. But they are being interpreted by different programming languages (one by <code>bash</code> the other by <code>awk</code>).</p>
</div>
</div>
</section>
<section id="so-what" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="so-what"><span class="header-section-number">3.1.2</span> So what?</h3>
<p>So far, this doesn’t seem very exciting, but now we learn that…</p>
<ul>
<li>You can tell <code>awk</code> the sorts of lines you want it to pause at and then do some <em>action</em> upon it.<br>
</li>
<li>You tell <code>awk</code> which lines you want to perform an action on by matching them with a logical statement called a <em>pattern</em> in <code>awk</code> parlance.</li>
</ul>
<p>This turns out to be incredibly powerful.</p>
</section>
<section id="awk-syntax-on-the-command-line" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="awk-syntax-on-the-command-line"><span class="header-section-number">3.1.3</span> <code>awk</code> syntax on the command line</h3>
<p>The syntax for running <code>awk</code> with a script on the command line is like this:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Don't try running this. It is just for explanation.</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename="Don't try running this. It is just for explanation."><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="st">  pattern1  {action1}</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="st">  pattern2  {action2}</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">'</span> file</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Where file is the name of the file you want to process.</p>
<p>Or, if you are piping text into <code>awk</code> from some command named <code>cmd</code> it would look like this:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Don't try running this. It is just for explanation.</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename="Don't try running this. It is just for explanation."><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">cmd</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">  pattern1  {action1}</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">  pattern2  {action2}</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that you can pass options (like <code>-v</code> or <code>-F</code>) to <code>awk</code>. They go right after the <code>awk</code> and before the first single quotation mark.</p>
<p>Also, the carriage returns inside the single quotation marks are only there for easy reading. You could also write the last example as:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Don't try running this. It is just for explanation.</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="Don't try running this. It is just for explanation."><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">cmd</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'pattern1  {action1} pattern2  {action2}'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>…which is great if you are hacking on the command line, but once you have a lot of pattern-action pairs, it gets harder to read.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Self-study
</div>
</div>
<div class="callout-body-container callout-body">
<p>Thinking back to the previous session when we talked about the difference between grouping strings with <code>'</code> vs with <code>"</code>, why do you think it is important that the <code>awk</code> script is grouped with <code>'</code>?</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Brief answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>As we saw, we will be referring to different fields like <code>$8</code> within the awk script. If we used <code>"</code> to group the script, the shell might try to do variable substitution on any <code>$</code>’s in there.</p>
</div>
</div>
</div>
</section>
</section>
<section id="enough-talking-lets-start-doing" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="enough-talking-lets-start-doing"><span class="header-section-number">3.2</span> Enough talking, let’s start doing</h2>
<p>All of this will make more sense with a few examples.</p>
<section id="print-all-the-lines-in-which-the-first-field-is-sn" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="print-all-the-lines-in-which-the-first-field-is-sn"><span class="header-section-number">3.2.1</span> Print all the lines in which the first field is <code>SN</code></h3>
<p>For our first foray, let’s just pick out and print a subset of lines from our samtools stats file:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Paste this into your terminal</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="Paste this into your terminal"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gzip</span> <span class="at">-cd</span> data/samtools_stats/s001_stats.tsv.gz <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'$1=="SN" {print}'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That is cool.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Self-study
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make sure that you can identify the <em>pattern</em> and the <em>action</em> in the above <code>awk</code> script.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer:
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>The <em>pattern</em> is <code>$1=="SN"</code></li>
<li>The <em>action</em> is <code>print</code></li>
</ul>
<p>This brings up the important point that the “is equals” operator in <code>awk</code> is <code>==</code> (two consecutive equals signs…just like in R)</p>
</div>
</div>
</div>
</section>
<section id="printing-the-lines-we-are-interested-in" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="printing-the-lines-we-are-interested-in"><span class="header-section-number">3.2.2</span> Printing the lines we are interested in</h3>
<p>How about if we wanted to pick out just a few particular lines from there?</p>
<p>Well, we can also match lines by <code>regular expression</code> (which you can think of as a very fancy form of Unix word-searching.)</p>
<p>Let’s say that we want information on the total number of reads mapped, the number of properly paired reads, and the total number of bases mapped using the (cigar) criterion.</p>
<p>We can see those lines in there. And we can target them by matching strings associated with them. The awk syntax puts these regular expressions in the pattern between forward slashes.</p>
<p>So, we want to match lines that have the first field equal to <code>SN</code> and also match other strings. We do that like this:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Paste this into your terminal</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="Paste this into your terminal"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gzip</span> <span class="at">-cd</span> data/samtools_stats/s001_stats.tsv.gz <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /reads mapped:/ {print}</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /reads properly paired:/ {print}</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /bases mapped \(cigar\):/ {print}</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Big Note:
</div>
</div>
<div class="callout-body-container callout-body">
<p>Regular expressions are lovely and wonderful, but occasionally frustrating. In <code>awk</code>’s case, parentheses have special meanings in the regular expressions, so we have to precede each one in the pattern with a backslash.</p>
<p>Regular expressions are a bit beyond the scope of what we will be talking about today (entire books are devoted to the topic) but I encourage everyone to learn about them.</p>
<p>They are incredibly useful and they are used in multiple programming languages (R, python, perl, etc.)</p>
</div>
</div>
</section>
<section id="printing-just-the-values-we-are-interested-in" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="printing-just-the-values-we-are-interested-in"><span class="header-section-number">3.2.3</span> Printing just the values we are interested in</h3>
<p>That is nice, but remember, we really just want to put those three values we are interested in into a table of sorts.</p>
<p>So, how do we print just the values?</p>
<p>Use the fields! Count columns for each line and then print just that field:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Study this, then paste this into your terminal</strong></pre>
</div>
<div class="sourceCode" id="cb7" data-filename="Study this, then paste this into your terminal"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gzip</span> <span class="at">-cd</span> data/samtools_stats/s001_stats.tsv.gz <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /reads mapped:/ {print $4}</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /reads properly paired:/ {print $5}</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /bases mapped \(cigar\):/ {print $5}</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="use-variables-inside-awk" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="use-variables-inside-awk"><span class="header-section-number">3.2.4</span> Use variables inside <code>awk</code></h3>
<p>We can also assign values to variables inside <code>awk</code>.</p>
<p>This lets us store values and then print them all on one line at the end. The special pattern <code>END</code> gives us a block to put actions we want to do at the very end.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Study this, then paste this into your terminal</strong></pre>
</div>
<div class="sourceCode" id="cb8" data-filename="Study this, then paste this into your terminal"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gzip</span> <span class="at">-cd</span> data/samtools_stats/s001_stats.tsv.gz <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /reads mapped:/ {rm = $4}</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /reads properly paired:/ {rpp = $5}</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /bases mapped \(cigar\):/ {bmc = $5}</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">  END {print rm, rpp, bmc}</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
For the programmers out there
</div>
</div>
<div class="callout-body-container callout-body">
<p>Variables in <code>awk</code> are untyped and do not be declared. Basically you can put them anywhere. If code calls for the value from a variable that has not has anything assigned to it yet, the variable returns a <code>0</code> in a numerical context, and an empty string in a string context.</p>
</div>
</div>
</section>
<section id="thats-great.-can-we-add-the-sample-name-in-there" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="thats-great.-can-we-add-the-sample-name-in-there"><span class="header-section-number">3.2.5</span> That’s great. Can we add the sample name in there?</h3>
<p>Yes! We can pass variables from the command line to inside <code>awk</code> with a <code>-v var=value</code> syntax.</p>
<p>To do this, we use some shell code that we learned earlier!</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Study this, then paste this into your terminal</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="Study this, then paste this into your terminal"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="va">FILE</span><span class="op">=</span>data/samtools_stats/s001_stats.tsv.gz</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gzip</span> <span class="at">-cd</span> <span class="va">$FILE</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-v</span> samp=<span class="va">$(</span><span class="fu">basename</span> <span class="va">${FILE</span><span class="op">/</span><span class="ss">_stats.tsv.gz</span><span class="op">/</span><span class="va">})</span> <span class="st">'</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /reads mapped:/ {rm = $4}</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /reads properly paired:/ {rpp = $5}</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="st">  $1=="SN" &amp;&amp; /bases mapped \(cigar\):/ {bmc = $5}</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="st">  END {print samp, rm, rpp, bmc}</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="omg-do-you-seen-where-we-are-going-with-this" class="level3" data-number="3.2.6">
<h3 data-number="3.2.6" class="anchored" data-anchor-id="omg-do-you-seen-where-we-are-going-with-this"><span class="header-section-number">3.2.6</span> OMG! Do you seen where we are going with this?</h3>
<p>We can now take that whole thing and imbed it within a bash <code>for</code> loop cycling over values of <code>FILE</code> and get the table talked about wanting in our Motivating Example when we started.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Study this, then paste this into your terminal</strong></pre>
</div>
<div class="sourceCode" id="cb10" data-filename="Study this, then paste this into your terminal"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> FILE <span class="kw">in</span> data/samtools_stats/<span class="pp">*</span>.gz<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gzip</span> <span class="at">-cd</span> <span class="va">$FILE</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="at">-v</span> samp=<span class="va">$(</span><span class="fu">basename</span> <span class="va">${FILE</span><span class="op">/</span><span class="ss">_stats.tsv.gz</span><span class="op">/</span><span class="va">})</span> <span class="st">'</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="st">    $1=="SN" &amp;&amp; /reads mapped:/ {rm = $4}</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="st">    $1=="SN" &amp;&amp; /reads properly paired:/ {rpp = $5}</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="st">    $1=="SN" &amp;&amp; /bases mapped \(cigar\):/ {bmc = $5}</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="st">    END {print samp, rm, rpp, bmc}</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="st">  '</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Yowzers! That is pretty quick, and it sure beats opening each file, copying the values we want, and then pasting them into a spreadsheet.</p>
</section>
</section>
<section id="another-example-the-distribution-of-mapping-qualities" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="another-example-the-distribution-of-mapping-qualities"><span class="header-section-number">3.3</span> Another example: the distribution of mapping qualities</h2>
<p>Here is a fun <code>awk</code> example that just came up a couple of days ago for me.</p>
<ul>
<li>A colleague was telling me that she has started filtering her whole-genome sequencing BAM files so that she does not use any reads that map with a mapping quality less than 30.</li>
<li>The hope is that this will lessen batch effects.</li>
<li>Questions:
<ul>
<li>What is the distribution of mapping quality scores in my own data</li>
<li>If we imposed such a filter, how many reads would we discard?</li>
</ul></li>
</ul>
<p>It turns out that none of the <code>samtools</code> programs <code>stat</code>, <code>idxstats</code>, or <code>flagstats</code> provide that distribution.</p>
<p>There are some other more obscure software packages that provide it, but also a lot of convoluted python code on the BioStars website for doing it.</p>
<p>Ha! It’s quick and easy with <code>awk</code>! And a great demonstration of <code>awk</code>’s associative arrays.</p>
<section id="lets-look-at-an-example-bam-file" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="lets-look-at-an-example-bam-file"><span class="header-section-number">3.3.1</span> Let’s look at an example bam file</h3>
<p>We have an example bam file in the repository at <code>data/bam/s0001.bam</code>.</p>
<p>It only has only about 25,000 read in it so that it isn’t too large.</p>
<p>Let’s have a look at it with:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Paste this into your terminal</strong></pre>
</div>
<div class="sourceCode" id="cb11" data-filename="Paste this into your terminal"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load bio/samtools</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view data/bam/s001.bam <span class="kw">|</span> <span class="fu">less</span> <span class="at">-S</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>module load bio/samtools</code> line gives us access to the <code>samtools</code> program, which we need for turning BAM files into text-based SAM files that we can use. Once we have given it in our shell, we have that access until we close the shell. Much more on that tomorrow!</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
If that failed you might need to define your MODULEPATH
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Here we check to see if the bioinformatics paths on in the MODULEPATH:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Paste this in your shell</strong></pre>
</div>
<div class="sourceCode" id="cb12" data-filename="Paste this in your shell"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$MODULEPATH</span> <span class="kw">|</span> <span class="fu">grep</span> bioinformatics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If that command did not return anything to <code>stdout</code>, then you need to add a command to your <code>~/.bashrc</code> that will add <code>/opt/bioinformatics/modulefiles</code> to your MODULEPATH. You can do that (as detailed in the <a href="https://docs.google.com/document/d/1nn0T0OWEsQCBoCdaH6DSY69lQSbK3XnPlseyyQuU2Lc/edit#">Sedna Google Doc</a>) like this:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>If you need to, paste this into the shell</strong></pre>
</div>
<div class="sourceCode" id="cb13" data-filename="If you need to, paste this into the shell"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">'export MODULEPATH=${MODULEPATH}:/opt/bioinformatics/modulefiles'</span> <span class="op">&gt;&gt;</span> ~/.bashrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And when you are done with that, reload your <code>.bashrc</code> to get the change to take effect:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>If you need to, paste this into the shell</strong></pre>
</div>
<div class="sourceCode" id="cb14" data-filename="If you need to, paste this into the shell"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/.bashrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The mapping quality is in the 5th field. It is a number that ranges from 0 to 60. We can count up how many times each of those numbers occurs using <code>awk</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Here it is all on one line as I wrote it</strong></pre>
</div>
<div class="sourceCode" id="cb15" data-filename="Here it is all on one line as I wrote it"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view data/bam/s001.bam <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'BEGIN {OFS="\t"; print "MAPQ", "NUM", "CUMUL";} {n[$5]++} END {for(i in n) tot+=n[i];  for(i=60;i&gt;=0;i--) {sum+=n[i]; print i, n[i], sum/tot;}}'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Here it is broken across lines. Paste that in your shell.</strong></pre>
</div>
<div class="sourceCode" id="cb16" data-filename="Here it is broken across lines. Paste that in your shell."><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view data/bam/s001.bam <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="st">  BEGIN {OFS="\t"; print "MAPQ", "NUM", "CUMUL";} </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="st">  {n[$5]++} </span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="st">  END {for(i in n) tot+=n[i];  for(i=60;i&gt;=0;i--) {sum+=n[i]; print i,n[i],sum/tot;}}</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s really compact and requires very little memory to do this. (You couldn’t read a whole BAM file into R and hope to deal with it).</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
All arrays in <code>awk</code> are associative arrays
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you come from an R programming background, you will typically think of arrays as vectors that are indexed from 1 to <code>n</code>, where <code>n</code> is the length of the vector.</p>
<p>This is not how arrays are implemented in <code>awk</code>. Rather all arrays are <em>associative arrays</em>, which are also called <em>hash arrays</em>, or, in Python <em>dictionaries</em>. Or, if you are familiar with R, you can think of an associative array as an array that has elements that can only be accessed via their names attribute, rather than by indexing them with a number.</p>
<p>So, in awk, if we write:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Don't paste this anywhere! We are just talking about awk</strong></pre>
</div>
<div class="sourceCode" id="cb17" data-filename="Don't paste this anywhere! We are just talking about awk"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="va">var</span><span class="op">[</span><span class="st">"this"</span><span class="op">]</span> <span class="ex">=</span> <span class="st">"Boing!"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will create an array called <code>var</code> (if one does not already exist) and then it will set the value of element in <code>var</code> that is associated with the string <code>"this"</code> to the string <code>"Boing!"</code>.</p>
<p>At the same time, if you do this:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Don't paste this anywhere! We are just talking about awk</strong></pre>
</div>
<div class="sourceCode" id="cb18" data-filename="Don't paste this anywhere! We are just talking about awk"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="va">var</span><span class="op">[</span><span class="dv">30</span><span class="op">]</span> <span class="ex">=</span> 67</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>then we are not assigning the value of <code>67</code> to the 30-th element of <code>var</code>. Rather, we are assigning the value <code>67</code> to the element of <code>var</code> that is associated with the string <code>"30"</code>.</p>
<p>It can take a little getting used to, but it is very useful for counting things.</p>
</div>
</div>
</section>
</section>
<section id="wrap-up" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="wrap-up"><span class="header-section-number">3.4</span> Wrap-Up</h2>
<p>That was just a brief whirlwind tour of how one can use bash and <code>awk</code> together to automate tasks that come up on an everyday basis when doing bioinformatics.</p>
</section>
<section id="looking-toward-tomorrow" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="looking-toward-tomorrow"><span class="header-section-number">3.5</span> Looking toward tomorrow</h2>
<p>The bulk of day #2 is going to be focused on working within a cluster environment, and specifically on using SLURM for launching jobs on the Sedna cluster.</p>
<p>To prepare for tomorrow, please be sure to read <a href="https://eriqande.github.io/eca-bioinf-handbook/chap-HPCC.html">Chapter 8</a> from beginning and up to and including section 8.2. This is just a small bit to read, but it should set you up for an understanding of why and how computing clusters work differently than your desktop machine when it comes to allocating resources for computation.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../nmfs-bioinf/shell-prog.html" class="pagination-link" aria-label="Shell Programming">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Shell Programming</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../nmfs-bioinf/scripts-and-functions.html" class="pagination-link" aria-label="Bash scripts and functions">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bash scripts and functions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>